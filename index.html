<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Card√°pio Nativo</title>
    <style>
        /* [CSS das vers√µes anteriores aqui] */
        :root { --primary: #2e7d32; --bg: #f0f2f5; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding: env(safe-area-inset-top) 10px 10px 10px; }
        /* Adicionando um bot√£o para permitir notifica√ß√µes */
        .btn-notif { background: #333; color: white; padding: 10px; border-radius: 5px; width: 100%; margin-bottom: 10px; border: none; font-size: 12px; }
    </style>
</head>
<body>

<div class="container">
    <button class="btn-notif" onclick="app.ativarNotificacoes()">üîî ATIVAR ALERTAS NO CELULAR</button>
    
    <div id="painel-alarme" style="display:none;">
        <div id="msg-alarme"></div>
        <button class="btn-ciente" onclick="app.pararAlarme()">CIENTE</button>
    </div>

    <div class="nav-tabs">
        <button class="tab active" onclick="app.mudarAba('dia', this)">Hoje</button>
        <button class="tab" onclick="app.mudarAba('semana', this)">Semana</button>
        <button class="tab" onclick="app.mudarAba('receitas', this)">Ingredientes</button>
        <button class="tab" onclick="app.mudarAba('compras', this)">Compras</button>
    </div>
    <div id="app-view"></div>
</div>

<script>
// Registro do Service Worker para modo Offline e PWA
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js');
}

const app = {
    // [L√≥gica da Vers√£o 28 aqui...]
    
    ativarNotificacoes() {
        Notification.requestPermission().then(perm => {
            if(perm === 'granted') {
                alert('Alertas ativados! O app agora pode te avisar mesmo em segundo plano.');
            }
        });
    },

    dispararAlerta(hora, msg) {
        // Alarme visual/sonoro interno (se o app estiver aberto)
        this.tocarSom(); 
        
        // Notifica√ß√£o do Sistema (se o app estiver em segundo plano)
        if (Notification.permission === 'granted') {
            new Notification(`HOR√ÅRIO: ${hora}`, {
                body: msg,
                icon: 'https://cdn-icons-png.flaticon.com/512/1048/1048953.png'
            });
        }
    }
    // ... restante das fun√ß√µes (mudarAba, gerar, etc)
};
window.onload = () => app.init();
</script>
</body>
</html>

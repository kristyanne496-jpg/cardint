<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card√°pio Inteligente v26 - Notifica√ß√µes Internas</title>
    <style>
        :root { --primary: #2e7d32; --bg: #f0f2f5; --text: #1a1a1a; --accent: #e65100; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding: 10px; color: var(--text); }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        
        /* Estilo da Central de Notifica√ß√µes Internas */
        .notificacao-interna { background: #fff3e0; border: 2px solid #ff9800; color: #b75300; padding: 15px; border-radius: 10px; margin-bottom: 20px; display: flex; align-items: center; gap: 15px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 152, 0, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(255, 152, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 152, 0, 0); } }
        
        .nav-tabs { display: flex; gap: 5px; margin-bottom: 20px; background: #e0e0e0; padding: 5px; border-radius: 10px; overflow-x: auto; }
        .tab { flex: 1; padding: 12px 8px; text-align: center; border-radius: 8px; cursor: pointer; font-weight: bold; border: none; background: transparent; font-size: 11px; white-space: nowrap; }
        .tab.active { background: var(--primary); color: white; }
        .bloco { border-left: 6px solid var(--primary); background: #f8f9fa; padding: 18px; margin-bottom: 15px; border-radius: 8px; }
        h3 { margin: 0 0 8px 0; font-size: 11px; color: #555; text-transform: uppercase; }
        .table-wrap { width: 100%; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 1100px; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: left; vertical-align: top; font-size: 11px; }
        .btn-reroll { cursor: pointer; background: #fff; border: 1px solid #ccc; border-radius: 4px; padding: 2px 4px; font-size: 12px; margin-left: 5px; }
        .item-compra { display: flex; align-items: center; gap: 10px; padding: 8px; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>

<div class="container">
    <div id="central-notificacao"></div>

    <div class="nav-tabs">
        <button id="tab-dia" class="tab active" onclick="app.mudarAba('dia', this)">Janela do Dia</button>
        <button class="tab" onclick="app.mudarAba('semana', this)">Tabela Semana</button>
        <button class="tab" onclick="app.mudarAba('receitas', this)">Ingredientes</button>
        <button class="tab" onclick="app.mudarAba('compras', this)">Lista de Compras</button>
    </div>
    <div id="app-view">Sincronizando...</div>
</div>

<script>
const app = {
    base: {
        cafe: [
            { t: "P√£o com ovo", m: false, s: "" },
            { t: "Cuscuz com ovo", m: false, s: "" },
            { t: "Mingau de tapioca", m: true, s: "P√£o com Manteiga e Caf√©" },
            { t: "Mingau de milho", m: true, s: "P√£o com Queijo e Caf√©" },
            { t: "Aipim cozido", m: false, s: "" }
        ],
        bebidas: ["Caf√© puro", "Suco de Laranja", "Ch√°", "Suco de Abacaxi"],
        arroz: ["Arroz Branco", "Arroz Integral", "Arroz com Cenoura"],
        feijao: ["Feij√£o Carioca", "Feij√£o Preto", "Feij√£o Fradinho"],
        frangos: ["Frango Assado", "Frango Grelhado", "Frango Ensopado", "Strogonoff"],
        carnes: ["Carne mo√≠da", "Bife acebolado", "Alm√¥ndegas", "Iscas de carne"],
        acompa: ["Pur√©", "Salada", "Couve", "Farofa", "Creme de milho"],
        lanchesM: ["Banana", "Ma√ß√£", "Uva", "Melancia"],
        lanchesT: ["Iogurte", "Bolo", "P√£o de Queijo", "Pipoca", "Sandu√≠che"],
        jantares: ["Sopa de Lentilha", "Omelete", "Canja", "Tapioca", "Caldo Verde"]
    },

    init() {
        if (!localStorage.getItem("plano_v26")) this.gerar();
        this.atualizarNotificacoesInternas();
        this.mudarAba('dia');
        // Atualiza a notifica√ß√£o a cada minuto sem recarregar o app
        setInterval(() => this.atualizarNotificacoesInternas(), 60000);
    },

    gerar() {
        const dias = ["SEGUNDA","TER√áA","QUARTA","QUINTA","SEXTA","S√ÅBADO","DOMINGO"];
        let plano = {};
        const f1 = this.base.feijao[Math.floor(Math.random()*3)];
        const f2 = this.base.feijao[Math.floor(Math.random()*3)];
        dias.forEach((d, i) => {
            const c = this.base.cafe[i % 5];
            plano[d] = {
                cafe: c.t, isMingau: c.m, opcao2: c.s,
                bebida: c.m ? "" : this.base.bebidas[i % 4],
                lancheM: this.base.lanchesM[i % 4],
                arroz: this.base.arroz[i % 3],
                feijao: (i < 4) ? f1 : f2,
                proteina: (i % 2 === 0) ? this.base.frangos[i % 4] : this.base.carnes[i % 4],
                acompa: this.base.acompa[i % 5],
                lancheT: this.base.lanchesT[i % 5],
                jantar: this.base.jantares[i % 5]
            };
        });
        localStorage.setItem("plano_v26", JSON.stringify(plano));
    },

    atualizarNotificacoesInternas() {
        const agora = new Date();
        const hora = agora.getHours();
        const min = agora.getMinutes();
        const tempo = hora * 60 + min;
        
        const plano = JSON.parse(localStorage.getItem("plano_v26"));
        const diasNomes = ["DOMINGO","SEGUNDA","TER√áA","QUARTA","QUINTA","SEXTA","S√ÅBADO"];
        const hoje = diasNomes[agora.getDay()];
        const amanha = diasNomes[(agora.getDay() + 1) % 7];
        
        const d = plano[hoje];
        const a = plano[amanha];
        let msg = "";

        // 07:30 at√© 13:00 - Almo√ßo
        if (tempo >= 450 && tempo < 780) {
            msg = `<strong>üìç Preparo do Almo√ßo:</strong> Iniciar ${d.arroz}, ${d.feijao}, ${d.proteina} e ${d.acompa}.`;
        } 
        // 13:00 at√© 19:00 - Frutas
        else if (tempo >= 780 && tempo < 1140) {
            msg = `<strong>üçé Log√≠stica de Frutas:</strong> Comprar para o Jantar (${d.jantar}), Caf√© (${a.cafe}), Lanche M (${a.lancheM}) e Almo√ßo (${a.arroz}).`;
        }
        // 19:00 at√© 21:00 - Padaria
        else if (tempo >= 1140 && tempo < 1260) {
            msg = `<strong>ü•ñ Padaria:</strong> Itens para o Jantar de hoje e Caf√© da manh√£ de amanh√£ (${a.cafe}).`;
        }
        // 21:00 em diante - Caf√© e Feij√£o
        else if (tempo >= 1260 || tempo < 450) {
            let feijaoAviso = d.feijao !== a.feijao ? `<br>‚ö†Ô∏è <strong>MOLHO:</strong> Colocar o ${a.feijao} de molho agora!` : "";
            msg = `<strong>üåô Preparo Noturno:</strong> Organizar Caf√© de amanh√£ (${a.cafe}). ${feijaoAviso}`;
        }

        const box = document.getElementById("central-notificacao");
        if (msg) {
            box.innerHTML = `<div class="notificacao-interna"><span>üîî</span><div>${msg}</div></div>`;
        }
    },

    mudarAba(aba, btn) {
        const painel = document.getElementById("app-view");
        const plano = JSON.parse(localStorage.getItem("plano_v26"));
        if (btn) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
        }
        const hojeIdx = new Date().getDay() === 0 ? 6 : new Date().getDay() - 1;
        const diasNomes = ["SEGUNDA","TER√áA","QUARTA","QUINTA","SEXTA","S√ÅBADO","DOMINGO"];
        const d = plano[diasNomes[hojeIdx]];

        if (aba === 'dia') {
            painel.innerHTML = `
                <div class="bloco"><h3>‚òï Caf√© da Manh√£</h3><p>${d.cafe}${d.bebida ? '<br>‚Ä¢ ' + d.bebida : ''}</p>${d.isMingau ? `<div style="color:var(--accent); font-weight:bold; margin-top:5px;">ü•™ Op√ß√£o S√≥lida: ${d.opcao2}</div>` : ''}</div>
                <div class="bloco"><h3>üçé Lanche Manh√£</h3><p>${d.lancheM}</p></div>
                <div class="bloco"><h3>üçõ Almo√ßo</h3><p>‚Ä¢ ${d.arroz}<br>‚Ä¢ ${d.feijao}<br>‚Ä¢ ${d.proteina}<br>‚Ä¢ ${d.acompa}</p></div>
                <div class="bloco"><h3>üç™ Lanche Tarde</h3><p>${d.lancheT}</p></div>
                <div class="bloco"><h3>üåô Jantar</h3><p>${d.jantar}</p></div>
            `;
        } else if (aba === 'semana') {
            let html = '<div class="table-wrap"><table><tr><th>Dia</th><th>Caf√©</th><th>L. Manh√£</th><th>Almo√ßo</th><th>L. Tarde</th><th>Jantar</th></tr>';
            diasNomes.forEach((dn) => {
                const dia = plano[dn];
                html += `<tr><td><b>${dn}</b></td><td>${dia.cafe}</td><td>${dia.lancheM}</td><td>${dia.arroz}<br>${dia.feijao}<br>${dia.proteina}</td><td>${dia.lancheT}</td><td>${dia.jantar}</td></tr>`;
            });
            painel.innerHTML = html + '</table></div>';
        } else if (aba === 'receitas') {
            let html = '<h2>Ingredientes Permanentes</h2>';
            [d.cafe, d.proteina, d.acompa, d.jantar, d.arroz, d.feijao].forEach(it => {
                const salvo = localStorage.getItem("ing_"+it) || "";
                html += `<div class="bloco"><h3>${it}</h3><textarea class="edit-box" oninput="localStorage.setItem('ing_${it}', this.value)">${salvo}</textarea></div>`;
            });
            painel.innerHTML = html;
        } else if (aba === 'compras') {
            let itens = new Set(["Arroz", "Feij√£o", "Azeite", "Sal"]);
            diasNomes.forEach(dn => {
                const dia = plano[dn];
                itens.add(dia.lancheM); itens.add(dia.lancheT);
                if(dia.bebida && !dia.isMingau) itens.add(dia.bebida);
                [dia.cafe, dia.proteina, dia.acompa, dia.jantar].forEach(p => {
                    const ing = localStorage.getItem("ing_"+p);
                    if(ing) ing.split(',').forEach(i => { if(i.trim()) itens.add(i.trim()); });
                });
            });
            let html = '<h2>Lista de Compras</h2><div class="bloco">';
            Array.from(itens).sort().forEach(it => html += `<label class="item-compra"><input type="checkbox"> ${it}</label>`);
            painel.innerHTML = html + '</div>';
        }
    }
};
window.onload = () => app.init();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card√°pio Inteligente v17 - Mem√≥ria Ativa</title>
    <style>
        :root { --primary: #4CAF50; --bg: #f4f4f9; --text: #333; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 10px; color: var(--text); }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 15px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .nav-tabs { display: flex; gap: 5px; margin-bottom: 15px; background: #eee; padding: 5px; border-radius: 10px; }
        .tab { flex: 1; padding: 12px 5px; text-align: center; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 13px; border: none; background: none; }
        .tab.active { background: var(--primary); color: white; }
        .bloco { border-left: 5px solid var(--primary); background: #f9f9f9; padding: 15px; margin-bottom: 12px; border-radius: 5px; }
        .bloco h3 { margin: 0 0 5px 0; font-size: 0.85em; color: #666; text-transform: uppercase; }
        .edit-box { width: 100%; min-height: 80px; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 5px; font-family: inherit; font-size: 14px; box-sizing: border-box; }
        .save-msg { color: var(--primary); font-size: 11px; font-weight: bold; display: none; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th { background: var(--primary); color: white; padding: 10px; font-size: 11px; }
        td { padding: 10px; border: 1px solid #eee; font-size: 11px; background: white; }
        .hoje-col { background: #e8f5e9 !important; font-weight: bold; border: 2px solid var(--primary) !important; }
    </style>
</head>
<body>

<div class="container">
    <div class="nav-tabs">
        <button class="tab active" onclick="app.mudarAba('dia', this)">Hoje</button>
        <button class="tab" onclick="app.mudarAba('semana', this)">Tabela</button>
        <button class="tab" onclick="app.mudarAba('receitas', this)">Ingredientes</button>
        <button class="tab" onclick="app.mudarAba('compras', this)">Compras</button>
    </div>
    <div id="conteudo-principal">Carregando card√°pio v17...</div>
</div>

<script>
const app = {
    // Banco original (Backup)
    base: {
        cafe: [
            { t: "P√£o com ovo", c: "sol", i: "P√£o, Ovos, Manteiga" },
            { t: "Cuscuz com ovo", c: "sol", i: "Milho, Ovos" },
            { t: "Mingau de tapioca", c: "liq", i: "Tapioca, Leite" },
            { t: "Mingau de milho", c: "liq", i: "Milho, Leite" },
            { t: "Aipim cozido", c: "sol", i: "Aipim, Manteiga" }
        ],
        almoco: {
            arroz: ["Arroz Branco", "Arroz com Cenoura"],
            feijoes: ["Carioca", "Preto", "Fradinho"],
            prot: ["Frango assado", "Carne mo√≠da", "Bife", "Peixe"],
            acompa: ["Pur√©", "Salada", "Couve", "Farofa"]
        },
        lanchesM: ["Banana", "Ma√ß√£", "Uva", "Pera"],
        lanchesT: ["Iogurte", "Bolo", "P√£o de Queijo", "Pipoca"]
    },

    // Fun√ß√£o para pegar ingrediente personalizado ou o padr√£o
    getIng(nome, padrao) {
        return localStorage.getItem("ing_" + nome) || padrao;
    },

    salvarIng(nome, texto) {
        localStorage.setItem("ing_" + nome, texto);
        document.getElementById("msg-" + nome.replace(/\s/g, '')).style.display = "inline";
        setTimeout(() => { document.querySelectorAll('.save-msg').forEach(m => m.style.display='none'); }, 2000);
    },

    shuffle(array) {
        let a = [...array];
        for (let i = a.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
    },

    gerarTudo() {
        const dias = ["SEGUNDA","TER√áA","QUARTA","QUINTA","SEXTA","S√ÅBADO","DOMINGO"];
        let plano = {};
        let dCafe = this.shuffle(this.base.cafe);
        let dLM = this.shuffle(this.base.lanchesM);
        let dLT = this.shuffle(this.base.lanchesT);
        let dProt = this.shuffle(this.base.almoco.prot);
        const f1 = this.base.almoco.feijoes[0];
        const f2 = this.base.almoco.feijoes[1];

        dias.forEach((d, index) => {
            const itemC = dCafe[index % dCafe.length];
            const feijao = (index < 4) ? f1 : f2;
            const itemP = dProt[index % dProt.length];

            plano[d] = {
                cafe_nome: itemC.t,
                cafe_txt: `${itemC.t}${itemC.c === "liq" ? "" : "<br>‚Ä¢ Caf√©"}`,
                isLiq: itemC.c === "liq",
                lancheM: dLM[index % dLM.length],
                almoco_nome: itemP,
                almoco_txt: `‚Ä¢ ${this.base.almoco.arroz[index % 2]}<br>‚Ä¢ Feij√£o ${feijao}<br>‚Ä¢ ${itemP}<br>‚Ä¢ ${this.base.almoco.acompa[index % 4]}`,
                lancheT: dLT[index % dLT.length],
                jantar_nome: "Arroz com Ovo"
            };
        });
        localStorage.setItem("plano_v17", JSON.stringify(plano));
        return plano;
    },

    mudarAba(aba, btn) {
        const container = document.getElementById("conteudo-principal");
        if (btn) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
        }

        let plano = JSON.parse(localStorage.getItem("plano_v17")) || this.gerarTudo();
        const diasNomes = ["SEGUNDA","TER√áA","QUARTA","QUINTA","SEXTA","S√ÅBADO","DOMINGO"];
        const hojeIdx = new Date().getDay() === 0 ? 6 : new Date().getDay() - 1;
        const d = plano[diasNomes[hojeIdx]];

        if (aba === 'dia') {
            container.innerHTML = `
                <div class="bloco"><h3>‚òï Caf√©</h3><p>${d.cafe_txt}</p>${d.isLiq ? '<b>Op√ß√£o 2: P√£o com Caf√©</b>' : ''}</div>
                <div class="bloco"><h3>üçõ Almo√ßo</h3><p>${d.almoco_txt}</p></div>
                <div class="bloco"><h3>üç™ Lanche Tarde</h3><p>${d.lancheT}</p></div>
            `;
        } else if (aba === 'receitas') {
            // Interface de Edi√ß√£o Permanente
            container.innerHTML = `
                <h2>Personalizar Ingredientes</h2>
                <div class="bloco">
                    <h3>Ingredientes: ${d.cafe_nome}</h3>
                    <textarea class="edit-box" oninput="app.salvarIng('${d.cafe_nome}', this.value)">${this.getIng(d.cafe_nome, "Ingredientes padr√£o do caf√©...")}</textarea>
                    <span class="save-msg" id="msg-${d.cafe_nome.replace(/\s/g, '')}">‚úì Salvo para o futuro!</span>
                </div>
                <div class="bloco">
                    <h3>Ingredientes: ${d.almoco_nome}</h3>
                    <textarea class="edit-box" oninput="app.salvarIng('${d.almoco_nome}', this.value)">${this.getIng(d.almoco_nome, "Ingredientes padr√£o do almo√ßo...")}</textarea>
                    <span class="save-msg" id="msg-${d.almoco_nome.replace(/\s/g, '')}">‚úì Salvo para o futuro!</span>
                </div>
            `;
        } else if (aba === 'semana') {
            let html = `<table><tr><th>Refei√ß√£o</th>`;
            diasNomes.forEach((dn, i) => html += `<th class="${i===hojeIdx?'hoje-col':''}">${dn}</th>`);
            html += `</tr>`;
            ["cafe_txt", "lancheM", "almoco_txt", "lancheT"].forEach(k => {
                html += `<tr><td><b>${k}</b></td>`;
                diasNomes.forEach((dn, i) => html += `<td class="${i===hojeIdx?'hoje-col':''}">${plano[dn][k]}</td>`);
                html += `</tr>`;
            });
            container.innerHTML = html + `</table>`;
        }
    }
};

window.onload = () => app.mudarAba('dia');
</script>
</body>
</html>

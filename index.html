<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card√°pio Inteligente v19</title>
    <style>
        :root { --primary: #4CAF50; --bg: #f4f4f9; --text: #333; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding: 10px; color: var(--text); }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .nav-tabs { display: flex; gap: 5px; margin-bottom: 15px; background: #ddd; padding: 5px; border-radius: 8px; }
        .tab { flex: 1; padding: 10px; text-align: center; border-radius: 6px; cursor: pointer; font-weight: bold; border: none; background: #eee; font-size: 12px; }
        .tab.active { background: var(--primary); color: white; }
        .bloco { border-left: 4px solid var(--primary); background: #f1f1f1; padding: 12px; margin-bottom: 10px; border-radius: 4px; }
        h3 { margin: 0 0 5px 0; font-size: 11px; color: #666; text-transform: uppercase; }
        p { margin: 0; font-size: 15px; }
        .edit-box { width: 100%; height: 60px; margin-top: 5px; padding: 8px; box-sizing: border-box; }
        .item-compra { display: block; padding: 8px; border-bottom: 1px solid #eee; font-size: 14px; }
        .item-compra input { margin-right: 10px; }
        .checked { text-decoration: line-through; color: #999; }
    </style>
</head>
<body>

<div class="container">
    <div class="nav-tabs">
        <button class="tab active" onclick="app.aba('dia', this)">Hoje</button>
        <button class="tab" onclick="app.aba('receitas', this)">Ingredientes</button>
        <button class="tab" onclick="app.aba('compras', this)">Compras</button>
    </div>
    
    <div id="painel">
        <p>A iniciar sistema... se n√£o carregar, <a href="#" onclick="app.reset()">clique aqui para resetar</a>.</p>
    </div>
</div>

<script>
const app = {
    // Dados fixos
    base: {
        cafe: ["P√£o com ovo", "Cuscuz", "Mingau de milho", "Mingau de tapioca", "Aipim"],
        almoco: ["Frango", "Carne mo√≠da", "Bife", "Peixe", "Alm√¥ndegas"],
        acompa: ["Pur√©", "Salada", "Couve", "Farofa"],
        lanches: ["Banana", "Ma√ß√£", "Uva", "Melancia", "Iogurte", "Bolo"],
        bebidas: ["Caf√©", "Leite", "Suco", "Ch√°"]
    },

    init() {
        try {
            // Se for a primeira vez ou vers√£o antiga, limpa tudo
            if (localStorage.getItem("v_app") !== "19") {
                localStorage.clear();
                localStorage.setItem("v_app", "19");
            }
            if (!localStorage.getItem("plano")) this.gerar();
            this.aba('dia');
        } catch (e) {
            document.getElementById("painel").innerHTML = "Erro ao carregar. <button onclick='app.reset()'>Resetar</button>";
        }
    },

    reset() {
        localStorage.clear();
        location.reload();
    },

    gerar() {
        const dias = ["SEGUNDA","TER√áA","QUARTA","QUINTA","SEXTA","S√ÅBADO","DOMINGO"];
        let plano = {};
        const f1 = "Carioca";
        const f2 = "Preto";

        dias.forEach((d, i) => {
            plano[d] = {
                cafe: this.base.cafe[i % 5],
                bebida: this.base.bebidas[i % 4],
                lanche: this.base.lanches[i % 6],
                almoco: this.base.almoco[i % 5],
                acompa: this.base.acompa[i % 4],
                feijao: (i < 4) ? f1 : f2,
                jantar: "Sopa ou Arroz com Ovo"
            };
        });
        localStorage.setItem("plano", JSON.stringify(plano));
    },

    aba(nome, btn) {
        const painel = document.getElementById("painel");
        const plano = JSON.parse(localStorage.getItem("plano"));
        if (btn) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
        }

        const hoje = new Date().getDay();
        const idx = hoje === 0 ? 6 : hoje - 1;
        const dias = ["SEGUNDA","TER√áA","QUARTA","QUINTA","SEXTA","S√ÅBADO","DOMINGO"];
        const d = plano[dias[idx]];

        if (nome === 'dia') {
            painel.innerHTML = `
                <div class="bloco"><h3>‚òï Caf√©</h3><p>${d.cafe}<br>‚Ä¢ ${d.bebida}</p></div>
                <div class="bloco"><h3>üçé Lanche</h3><p>${d.lanche}</p></div>
                <div class="bloco"><h3>üçõ Almo√ßo</h3><p>‚Ä¢ Arroz<br>‚Ä¢ Feij√£o ${d.feijao}<br>‚Ä¢ ${d.almoco}<br>‚Ä¢ ${d.acompa}</p></div>
                <div class="bloco"><h3>üåô Jantar</h3><p>${d.jantar}</p></div>
            `;
        } else if (nome === 'receitas') {
            let html = "<h2>Ingredientes Permanentes</h2>";
            const refs = [d.cafe, d.almoco, d.jantar];
            refs.forEach(r => {
                const salvo = localStorage.getItem("ing_"+r) || "";
                html += `<div class="bloco"><h3>${r}</h3>
                <textarea class="edit-box" oninput="localStorage.setItem('ing_${r}', this.value)" placeholder="Digite ingredientes...">${salvo}</textarea></div>`;
            });
            painel.innerHTML = html;
        } else if (nome === 'compras') {
            let itens = new Set(["Arroz", "Feij√£o", "A√ß√∫car", "Caf√©"]);
            dias.forEach(dia => {
                const dd = plano[dia];
                itens.add(dd.lanche);
                itens.add(dd.bebida);
                const p1 = localStorage.getItem("ing_"+dd.cafe);
                const p2 = localStorage.getItem("ing_"+dd.almoco);
                if(p1) p1.split(',').forEach(i => itens.add(i.trim()));
                if(p2) p2.split(',').forEach(i => itens.add(i.trim()));
            });

            let html = "<h2>Lista de Compras</h2><div class='bloco'>";
            Array.from(itens).sort().forEach((it, i) => {
                if(it.length > 2) {
                    html += `<label class="item-compra"><input type="checkbox" onclick="this.parentNode.classList.toggle('checked')"> ${it}</label>`;
                }
            });
            painel.innerHTML = html + "</div>";
        }
    }
};

window.onload = () => app.init();
</script>
</body>
</html>

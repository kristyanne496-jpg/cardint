<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meu Card√°pio Inteligente</title>

<style>
:root { --primary:#4CAF50; --bg:#f4f4f9; }
body { font-family: Arial, sans-serif; background:var(--bg); margin:0; padding:15px; }
.container { max-width:600px; margin:auto; background:#fff; padding:20px; border-radius:12px; }
.nav-tabs { display:flex; gap:8px; margin-bottom:15px; }
.tab { flex:1; padding:10px; text-align:center; background:#eee; border-radius:8px; cursor:pointer; font-weight:bold; }
.tab.active { background:var(--primary); color:#fff; }
.bloco { background:#f9f9f9; border-left:4px solid var(--primary); padding:10px; margin-bottom:10px; border-radius:5px; }
button { width:100%; padding:12px; background:var(--primary); color:#fff; border:none; border-radius:8px; cursor:pointer; }
</style>
</head>

<body>
<div class="container">
    <div class="nav-tabs">
        <div class="tab active" onclick="app.mudarAba('dia',this)">Hoje</div>
        <div class="tab" onclick="app.mudarAba('semana',this)">Semana</div>
        <div class="tab" onclick="app.mudarAba('compras',this)">Compras</div>
    </div>
    <div id="conteudo"></div>
</div>

<script>
const app = {

    // ================= BANCO DE DADOS COMPLETO =================
    banco: {

        cafe: {
            bases: [
                "P√£o franc√™s","P√£o de forma","P√£o caseiro","Tapioca","Cuscuz",
                "Bolo simples caseiro","Panqueca","Crepioca","Mingau de aveia",
                "Mingau de milho","P√£o de queijo","Torrada","Aipim cozido",
                "Banana da terra cozida","Batata doce cozida","Iogurte com frutas",
                "Mingau de tapioca"
            ],
            acompanhamentos: [
                "Manteiga ou Margarina","Requeij√£o","Cream cheese","Catupiry",
                "Queijo mussarela","Ovo mexido","Ovo cozido",
                "Pat√™ de frango caseiro","Pat√™ de atum caseiro",
                "Presunto","Mortadela","Peito de peru"
            ],
            bebidas: [
                "Caf√©","Leite com achocolatado","Ch√°","Vitamina",
                "Ch√° gelado","Suco de uva integral","Suco"
            ]
        },

        almoco: {
            feijoes: ["Feij√£o carioca","Feij√£o preto","Feij√£o fradinho"],
            proteinas: [
                "Frango cozido","Frango frito","Frango assado","Frango desfiado",
                "Carne mo√≠da","Carne do sol","Carne de panela","Bife no molho",
                "Alm√¥ndega","Peixe frito","Steak de frango","Iscas de frango",
                "F√≠gado acebolado","Moqueca","Ovo mexido","Panqueca de carne",
                "Lingui√ßa","Panqueca de frango","Salsicha"
            ],
            acompanhamentos: [
                "Macarr√£o","Pur√™ de ab√≥bora","Pur√™ de batata","Pur√™ de aipim",
                "Batata cozida","Mandioca frita","Batata frita",
                "Salada de maionese","Salada de alface com tomate",
                "Salada de couve com tomate","Vinagrete","Couve refogada",
                "Creme de milho","Farofa pronta","Farofa de banana da terra",
                "Farofa de cebola","Farofa de cenoura"
            ],
            especial: "Feijoada completa"
        },

        jantar: {
            opcoes: [
                "Arroz com ovo","Arroz com frango","Macarr√£o com frango",
                "Sopa","Caldo de carne","Caldo de frango","Caldo de calabresa",
                "Mini salgados","Cachorro-quente","Pizza","Hamb√∫rguer",
                "Arroz doce","P√£o franc√™s","P√£o de forma","P√£o caseiro",
                "Tapioca","Cuscuz com ovo","Cuscuz com banana da terra",
                "Cuscuz com carne do sol","Farofa de cuscuz","Bolo simples",
                "Panqueca de frango","Panqueca de carne","Crepioca",
                "Mingau de aveia","Mingau de milho","P√£o de queijo","Torrada",
                "Aipim cozido","Banana da terra cozida","Batata doce cozida"
            ]
        },

        lanches: {
            frutas: [
                "Banana","Ma√ß√£","Uva","Abacaxi","Pera","Manga","Melancia",
                "Ma√ß√£ verde","Tangerina","Morango","Laranja","Ameixa"
            ],
            tarde: [
                "Biscoito","Iogurte com frutas","Iogurte com granola",
                "Bolo caseiro","Vitamina de a√ßa√≠","Vitamina de frutas",
                "Sonho de padaria","Salada de frutas"
            ]
        }
    },

    // ================= L√ìGICA =================
    escolher(lista) {
        return lista[Math.floor(Math.random() * lista.length)];
    },

    gerarDia() {
        return {
            cafe: {
                base: this.escolher(this.banco.cafe.bases),
                acomp: this.escolher(this.banco.cafe.acompanhamentos),
                bebida: this.escolher(this.banco.cafe.bebidas)
            },
            lancheManha: this.escolher(this.banco.lanches.frutas),
            almoco: {
                feijao: this.escolher(this.banco.almoco.feijoes),
                proteina: this.escolher(this.banco.almoco.proteinas),
                acomp: this.escolher(this.banco.almoco.acompanhamentos)
            },
            lancheTarde: this.escolher(this.banco.lanches.tarde),
            jantar: this.escolher(this.banco.jantar.opcoes)
        };
    },

    gerarSemana() {
        const dias = ["Segunda","Ter√ßa","Quarta","Quinta","Sexta","S√°bado","Domingo"];
        let semana = {};
        dias.forEach(d => semana[d] = this.gerarDia());
        localStorage.setItem("semana", JSON.stringify(semana));
        return semana;
    },

    obterSemana() {
        return JSON.parse(localStorage.getItem("semana")) || this.gerarSemana();
    },

    mudarAba(aba, el) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    el.classList.add('active');

    const c = document.getElementById("conteudo");

    if (aba === "dia") this.renderDia(c);
    else if (aba === "semana") this.renderSemana(c);
    else this.renderCompras(c);
},


    renderDia(el) {
        const semana = this.obterSemana();
        const hoje = new Date().getDay();
        const nomes = ["Domingo","Segunda","Ter√ßa","Quarta","Quinta","Sexta","S√°bado"];
        const d = semana[nomes[hoje]];

        el.innerHTML = `
            <h2>${nomes[hoje]}</h2>
            <div class="bloco">‚òï ${d.cafe.base} com ${d.cafe.acomp} e ${d.cafe.bebida}</div>
            <div class="bloco">üçé ${d.lancheManha}</div>
            <div class="bloco">üçõ ${d.almoco.feijao}, ${d.almoco.proteina} e ${d.almoco.acomp}</div>
            <div class="bloco">üç™ ${d.lancheTarde}</div>
            <div class="bloco">üåô ${d.jantar}</div>
            <button onclick="app.gerarSemana();app.renderDia(document.getElementById('conteudo'))">
                Gerar novo card√°pio
            </button>
        `;
    },

    renderSemana(el) {
        const semana = this.obterSemana();
        let html = "<h2>Semana Completa</h2>";
        for (let dia in semana) {
            const d = semana[dia];
            html += `
                <div class="bloco">
                    <strong>${dia}</strong><br>
                    ‚òï ${d.cafe.base}<br>
                    üçõ ${d.almoco.feijao}, ${d.almoco.proteina}<br>
                    üåô ${d.jantar}
                </div>`;
        }
        el.innerHTML = html;
    }
};
gerarListaCompras() {
    const semana = this.obterSemana();
    const itens = new Set();

    Object.values(semana).forEach(dia => {

        // Caf√©
        itens.add(dia.cafe.base);
        itens.add(dia.cafe.acomp);
        itens.add(dia.cafe.bebida);

        // Lanches
        itens.add(dia.lancheManha);
        itens.add(dia.lancheTarde);

        // Almo√ßo
        itens.add(dia.almoco.feijao);
        itens.add(dia.almoco.proteina);
        itens.add(dia.almoco.acomp);

        // Jantar
        itens.add(dia.jantar);
    });

    return Array.from(itens).sort();
},
renderCompras(el) {
    const lista = this.gerarListaCompras();
    const estoque = JSON.parse(localStorage.getItem("estoque") || "[]");

    let html = `<h2>üõí Lista de Compras</h2>
        <p style="font-size:0.85em;color:#666">
            Marque o que voc√™ j√° tem em casa
        </p>
        <button onclick="app.limparEstoque()" style="background:#f44336">
            Limpar sele√ß√£o
        </button>
        <ul style="list-style:none;padding:0">`;

    lista.forEach(item => {
        const marcado = estoque.includes(item);
        html += `
            <li style="
                display:flex;
                justify-content:space-between;
                padding:10px;
                margin-bottom:6px;
                background:${marcado ? '#e8f5e9' : '#f9f9f9'};
                border-radius:8px;
            ">
                <span style="${marcado ? 'text-decoration:line-through;opacity:.6' : ''}">
                    ${item}
                </span>
                <input type="checkbox"
                    ${marcado ? 'checked' : ''}
                    onchange="app.toggleEstoque('${item}')">
            </li>`;
    });

    el.innerHTML = html + "</ul>";
},
toggleEstoque(item) {
    let estoque = JSON.parse(localStorage.getItem("estoque") || "[]");

    if (estoque.includes(item)) {
        estoque = estoque.filter(i => i !== item);
    } else {
        estoque.push(item);
    }

    localStorage.setItem("estoque", JSON.stringify(estoque));
    this.renderCompras(document.getElementById("conteudo"));
},

limparEstoque() {
    if (confirm("Deseja desmarcar todos os itens?")) {
        localStorage.setItem("estoque", "[]");
        this.renderCompras(document.getElementById("conteudo"));
    }
},
agendarNotificacoes() {
    if (!("Notification" in window)) return;

    Notification.requestPermission().then(permission => {
        if (permission !== "granted") return;

        const agora = new Date();

        // Fun√ß√£o para agendar uma notifica√ß√£o
        const agendar = (hora, min, texto) => {
            const alvo = new Date();
            alvo.setHours(hora, min, 0, 0);
            if (alvo < agora) alvo.setDate(alvo.getDate() + 1); // pr√≥xima ocorr√™ncia

            const tempo = alvo - agora;
            setTimeout(() => {
                new Notification("Meu Card√°pio Inteligente", { body: texto });
                agendar(hora, min, texto); // reagenda para amanh√£
            }, tempo);
        };

        const semana = this.obterSemana();
        const hojeIdx = new Date().getDay();
        const nomes = ["Domingo","Segunda","Ter√ßa","Quarta","Quinta","Sexta","S√°bado"];
        const hoje = semana[nomes[hojeIdx]];

        // 13:00 ‚Üí frutas das pr√≥ximas refei√ß√µes
        let frutas = [];
        frutas.push(hoje.lancheManha);
        frutas.push(hoje.lancheTarde);

        if (hojeIdx < 6) {
            const amanha = semana[nomes[hojeIdx + 1]];
            frutas.push(amanha.lancheManha);
        }
        frutas = frutas.filter(i => this.banco.lanches.frutas.includes(i));
        const textoFrutas = frutas.length ? `N√£o esque√ßa de comprar: ${frutas.join(", ")}` : "Sem frutas adicionais hoje";

        agendar(13, 0, textoFrutas);

        // 19:00 ‚Üí itens de padaria do jantar ou caf√© da manh√£ do dia seguinte
        let padaria = [];

        // itens do jantar de hoje
        const jantarHoje = hoje.jantar.toLowerCase();
        if (jantarHoje.includes("p√£o") || jantarHoje.includes("torrada") || jantarHoje.includes("bolo") || jantarHoje.includes("panqueca") || jantarHoje.includes("tapioca") || jantarHoje.includes("cuscuz")) {
            padaria.push(hoje.jantar);
        }

        // caf√© da manh√£ do dia seguinte
        if (hojeIdx < 6) {
            const amanha = semana[nomes[hojeIdx + 1]];
            const cafe = amanha.cafe.base.toLowerCase();
            if (cafe.includes("p√£o") || cafe.includes("torrada") || cafe.includes("bolo") || cafe.includes("panqueca") || cafe.includes("tapioca") || cafe.includes("cuscuz")) {
                padaria.push(amanha.cafe.base);
            }
        }

        const textoPadaria = padaria.length ? `Comprar itens de padaria: ${padaria.join(", ")}` : "Nenhum item de padaria hoje";

        agendar(19, 0, textoPadaria);
    });
app.agendarNotificacoes();
},

app.mudarAba("dia", document.querySelector(".tab"));
</script>
</body>
</html>

